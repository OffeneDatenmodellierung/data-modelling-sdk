{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/offenedatenmodellierung/data-modelling-sdk/schemas/workspace-schema.json",
  "title": "Workspace Schema",
  "description": "Schema for a Workspace entity in the data modelling application. Workspaces are top-level containers that organize domains, systems, their associated assets, and relationships. All files use a flat naming convention: {workspace}_{domain}_{system}_{resource}.xxx.yaml. Related sub-schemas: common-types-schema.json, domain-schema.json, system-schema.json",
  "type": "object",
  "required": ["id", "name", "ownerId", "createdAt", "lastModifiedAt"],
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for the workspace"
    },
    "name": {
      "type": "string",
      "maxLength": 255,
      "pattern": "^[a-zA-Z0-9][a-zA-Z0-9_-]*$",
      "description": "Workspace name (used in file naming, must be valid for filenames)"
    },
    "ownerId": {
      "type": "string",
      "format": "uuid",
      "description": "Owner/creator user identifier"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of creation"
    },
    "lastModifiedAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last modification"
    },
    "domains": {
      "type": "array",
      "description": "Array of domain references with their systems",
      "items": {
        "$ref": "#/definitions/DomainReference"
      }
    },
    "assets": {
      "type": "array",
      "description": "Array of asset references in this workspace",
      "items": {
        "$ref": "#/definitions/AssetReference"
      }
    },
    "relationships": {
      "type": "array",
      "description": "Array of relationships between assets in this workspace",
      "items": {
        "$ref": "#/definitions/Relationship"
      }
    }
  },
  "additionalProperties": false,
  "definitions": {
    "DomainReference": {
      "type": "object",
      "description": "Domain reference within a workspace. Also defined in domain-schema.json.",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Domain identifier"
        },
        "name": {
          "type": "string",
          "maxLength": 255,
          "pattern": "^[a-zA-Z0-9][a-zA-Z0-9_-]*$",
          "description": "Domain name (used in file naming)"
        },
        "description": {
          "type": "string",
          "description": "Optional description of the domain"
        },
        "systems": {
          "type": "array",
          "description": "Systems within this domain",
          "items": {
            "$ref": "#/definitions/SystemReference"
          }
        },
        "sharedResources": {
          "type": "array",
          "description": "Shared resources available across the domain (schemas, libraries, utilities)",
          "items": {
            "$ref": "#/definitions/SharedResource"
          }
        },
        "transformationLinks": {
          "type": "array",
          "description": "Links to transformations and data pipelines associated with this domain",
          "items": {
            "$ref": "#/definitions/TransformationLink"
          }
        },
        "tableVisibility": {
          "$ref": "#/definitions/TableVisibility"
        },
        "viewPositions": {
          "type": "object",
          "description": "Per-view node positions for canvas rendering. Keys are view types (operational, analytical, process, systems), values are objects mapping entity IDs to x/y coordinates.",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/definitions/ViewPosition"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "TableVisibility": {
      "type": "string",
      "description": "Default visibility setting for tables within a domain",
      "enum": ["public", "domainOnly", "hidden"],
      "default": "public"
    },
    "SharedResource": {
      "type": "object",
      "description": "Shared resource within a domain (e.g., shared schemas, libraries, utilities)",
      "required": ["id", "name", "resourceType"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier for the resource"
        },
        "name": {
          "type": "string",
          "description": "Name of the shared resource"
        },
        "resourceType": {
          "type": "string",
          "description": "Type of resource (e.g., 'schema', 'library', 'utility', 'template')"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "URL or path to the resource"
        },
        "description": {
          "type": "string",
          "description": "Optional description"
        }
      },
      "additionalProperties": false
    },
    "TransformationLink": {
      "type": "object",
      "description": "Link to a transformation or data pipeline",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier for the transformation"
        },
        "name": {
          "type": "string",
          "description": "Name of the transformation"
        },
        "transformationType": {
          "type": "string",
          "description": "Type of transformation (e.g., 'dbt', 'spark', 'airflow')"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "URL or path to the transformation definition"
        },
        "description": {
          "type": "string",
          "description": "Optional description"
        }
      },
      "additionalProperties": false
    },
    "SystemType": {
      "type": "string",
      "description": "Type of system infrastructure. Also defined in system-schema.json.",
      "enum": [
        "PostgreSQL",
        "MySQL",
        "Mssql",
        "Oracle",
        "Sqlite",
        "MariaDB",
        "DynamoDB",
        "Cassandra",
        "MongoDB",
        "Redis",
        "ElasticSearch",
        "CouchDB",
        "Neo4j",
        "RdsPostgreSQL",
        "RdsMySQL",
        "RdsMariaDB",
        "RdsOracle",
        "RdsSqlServer",
        "Redshift",
        "Aurora",
        "DocumentDB",
        "Neptune",
        "ElastiCache",
        "S3",
        "Eks",
        "Ecs",
        "Lambda",
        "Kinesis",
        "Sqs",
        "Sns",
        "Glue",
        "Athena",
        "QuickSight",
        "AzureSqlDatabase",
        "CosmosDB",
        "AzureSynapseAnalytics",
        "AzureDataLakeStorage",
        "AzureBlobStorage",
        "Aks",
        "Aci",
        "AzureFunctions",
        "EventHubs",
        "ServiceBus",
        "AzureDataFactory",
        "PowerBI",
        "CloudSqlPostgreSQL",
        "CloudSqlMySQL",
        "CloudSqlSqlServer",
        "BigQuery",
        "CloudSpanner",
        "Firestore",
        "CloudStorage",
        "Gke",
        "CloudRun",
        "CloudFunctions",
        "PubSub",
        "Dataflow",
        "Looker",
        "Kafka",
        "Pulsar",
        "RabbitMQ",
        "ActiveMQ",
        "Kubernetes",
        "Docker",
        "Snowflake",
        "Databricks",
        "Teradata",
        "Vertica",
        "Tableau",
        "Qlik",
        "Metabase",
        "ApacheSuperset",
        "Grafana",
        "Hdfs",
        "MinIO"
      ]
    },
    "AuthMethod": {
      "type": "string",
      "description": "Authentication method for connecting to a system. Also defined in system-schema.json.",
      "enum": [
        "oauth2",
        "apiKey",
        "iamRole",
        "certificate",
        "basicAuth",
        "saml",
        "oidc",
        "kerberos",
        "awsSignatureV4",
        "gcpServiceAccount",
        "azureActiveDirectory",
        "mtls",
        "none",
        "custom"
      ]
    },
    "EnvironmentStatus": {
      "type": "string",
      "description": "Current status of an environment. Also defined in system-schema.json.",
      "enum": ["active", "deprecated", "maintenance", "inactive"],
      "default": "active"
    },
    "EnvironmentConnection": {
      "type": "object",
      "description": "Environment-specific connection details for a system. Systems may have multiple environments (production, staging, etc.) each with different connection details, SLAs, and ownership. Also defined in system-schema.json.",
      "required": ["environment"],
      "properties": {
        "environment": {
          "type": "string",
          "description": "Environment name (e.g., 'production', 'staging', 'development')"
        },
        "owner": {
          "type": "string",
          "description": "Owner/team responsible for this environment"
        },
        "contactDetails": {
          "$ref": "#/definitions/ContactDetails"
        },
        "sla": {
          "type": "array",
          "description": "SLA properties for this environment",
          "items": {
            "$ref": "#/definitions/SlaProperty"
          }
        },
        "authMethod": {
          "$ref": "#/definitions/AuthMethod"
        },
        "supportTeam": {
          "type": "string",
          "description": "Support team or on-call rotation name"
        },
        "connectionString": {
          "type": "string",
          "description": "Connection string (sensitive - may be placeholder or reference)"
        },
        "secretLink": {
          "type": "string",
          "format": "uri",
          "description": "Link to secrets manager entry (e.g., AWS Secrets Manager, HashiCorp Vault)"
        },
        "endpoint": {
          "type": "string",
          "description": "Primary endpoint URL or hostname"
        },
        "port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "description": "Port number for the connection"
        },
        "region": {
          "type": "string",
          "description": "Cloud region or data center location"
        },
        "status": {
          "$ref": "#/definitions/EnvironmentStatus"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes about this environment"
        },
        "customProperties": {
          "type": "object",
          "description": "Additional custom properties for extensibility",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },
    "SystemReference": {
      "type": "object",
      "description": "System reference within a domain. Systems represent infrastructure components like databases, message queues, or cloud services. Also defined in system-schema.json.",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "System identifier"
        },
        "name": {
          "type": "string",
          "maxLength": 255,
          "pattern": "^[a-zA-Z0-9][a-zA-Z0-9_-]*$",
          "description": "System name (used in file naming)"
        },
        "description": {
          "type": "string",
          "description": "Optional description of the system"
        },
        "systemType": {
          "$ref": "#/definitions/SystemType"
        },
        "tableIds": {
          "type": "array",
          "description": "Optional array of table UUIDs that belong to this system. When present, provides explicit table-to-system mapping without requiring parsing of individual ODCS files.",
          "items": {
            "type": "string",
            "format": "uuid"
          }
        },
        "assetIds": {
          "type": "array",
          "description": "Optional array of compute asset (CADS) UUIDs that belong to this system. When present, provides explicit asset-to-system mapping.",
          "items": {
            "type": "string",
            "format": "uuid"
          }
        },
        "environments": {
          "type": "array",
          "description": "List of environment-specific connection details (production, staging, development, etc.)",
          "items": {
            "$ref": "#/definitions/EnvironmentConnection"
          }
        }
      },
      "additionalProperties": false
    },
    "AssetReference": {
      "type": "object",
      "required": ["id", "name", "domain", "assetType"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Asset identifier"
        },
        "name": {
          "type": "string",
          "maxLength": 255,
          "description": "Asset name"
        },
        "domain": {
          "type": "string",
          "description": "Domain name this asset belongs to"
        },
        "system": {
          "type": "string",
          "description": "Optional system name (if asset is within a system)"
        },
        "assetType": {
          "type": "string",
          "enum": ["odcs", "odps", "cads", "bpmn", "dmn", "openapi", "sketch"],
          "description": "Type of asset"
        },
        "filePath": {
          "type": "string",
          "description": "File path relative to workspace (generated from naming convention)"
        }
      },
      "additionalProperties": false
    },
    "Relationship": {
      "type": "object",
      "required": [
        "id",
        "sourceTableId",
        "targetTableId",
        "createdAt",
        "updatedAt"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier for the relationship"
        },
        "sourceTableId": {
          "type": "string",
          "format": "uuid",
          "description": "ID of the source table/asset"
        },
        "targetTableId": {
          "type": "string",
          "format": "uuid",
          "description": "ID of the target table/asset"
        },
        "label": {
          "type": "string",
          "description": "Human-readable label for the relationship (displayed on the edge in UI)"
        },
        "sourceKey": {
          "type": "string",
          "description": "Key/column name on the source side of the relationship"
        },
        "targetKey": {
          "type": "string",
          "description": "Key/column name on the target side of the relationship"
        },
        "cardinality": {
          "type": "string",
          "enum": ["oneToOne", "oneToMany", "manyToMany"],
          "description": "Legacy relationship cardinality (use sourceCardinality/targetCardinality for crow's feet notation)"
        },
        "sourceOptional": {
          "type": "boolean",
          "description": "Whether the source side is optional (legacy field)"
        },
        "targetOptional": {
          "type": "boolean",
          "description": "Whether the target side is optional (legacy field)"
        },
        "sourceCardinality": {
          "type": "string",
          "enum": ["zeroOrOne", "exactlyOne", "zeroOrMany", "oneOrMany"],
          "description": "Crow's feet cardinality at the source end"
        },
        "targetCardinality": {
          "type": "string",
          "enum": ["zeroOrOne", "exactlyOne", "zeroOrMany", "oneOrMany"],
          "description": "Crow's feet cardinality at the target end"
        },
        "flowDirection": {
          "type": "string",
          "enum": ["sourceToTarget", "targetToSource", "bidirectional"],
          "description": "Direction of data flow in the relationship"
        },
        "relationshipType": {
          "type": "string",
          "enum": ["foreignKey", "dataFlow", "dependency", "etl"],
          "description": "Type of relationship"
        },
        "foreignKeyDetails": {
          "$ref": "#/definitions/ForeignKeyDetails"
        },
        "etlJobMetadata": {
          "$ref": "#/definitions/ETLJobMetadata"
        },
        "notes": {
          "type": "string",
          "description": "Optional notes about the relationship"
        },
        "owner": {
          "type": "string",
          "description": "Owner information for the relationship"
        },
        "sla": {
          "type": "array",
          "description": "SLA (Service Level Agreement) information",
          "items": {
            "$ref": "#/definitions/SlaProperty"
          }
        },
        "contactDetails": {
          "$ref": "#/definitions/ContactDetails"
        },
        "infrastructureType": {
          "type": "string",
          "enum": [
            "kafka",
            "airflow",
            "spark",
            "databricks",
            "snowflake",
            "fivetran",
            "dbt",
            "custom"
          ],
          "description": "Infrastructure type for data flow relationships"
        },
        "visualMetadata": {
          "$ref": "#/definitions/VisualMetadata"
        },
        "drawioEdgeId": {
          "type": "string",
          "description": "Draw.io edge ID for diagram integration"
        },
        "color": {
          "type": "string",
          "description": "Color for the relationship line in the UI (hex color code or named color)",
          "pattern": "^(#[0-9A-Fa-f]{6}|#[0-9A-Fa-f]{3}|[a-zA-Z]+)$"
        },
        "sourceHandle": {
          "type": "string",
          "description": "Edge attachment point on the source node",
          "enum": [
            "top-left",
            "top-center",
            "top-right",
            "right-top",
            "right-center",
            "right-bottom",
            "bottom-right",
            "bottom-center",
            "bottom-left",
            "left-bottom",
            "left-center",
            "left-top"
          ]
        },
        "targetHandle": {
          "type": "string",
          "description": "Edge attachment point on the target node",
          "enum": [
            "top-left",
            "top-center",
            "top-right",
            "right-top",
            "right-center",
            "right-bottom",
            "bottom-right",
            "bottom-center",
            "bottom-left",
            "left-bottom",
            "left-center",
            "left-top"
          ]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of creation"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of last update"
        }
      },
      "additionalProperties": true
    },
    "ViewPosition": {
      "type": "object",
      "description": "X/Y coordinates for node positioning on canvas. Also defined in common-types-schema.json.",
      "required": ["x", "y"],
      "properties": {
        "x": {
          "type": "number",
          "description": "X coordinate on canvas"
        },
        "y": {
          "type": "number",
          "description": "Y coordinate on canvas"
        }
      },
      "additionalProperties": false
    },
    "ForeignKeyDetails": {
      "type": "object",
      "description": "Foreign key column mapping details",
      "required": ["sourceColumn", "targetColumn"],
      "properties": {
        "sourceColumn": {
          "type": "string",
          "description": "Column name in the source table"
        },
        "targetColumn": {
          "type": "string",
          "description": "Column name in the target table"
        }
      },
      "additionalProperties": false
    },
    "ETLJobMetadata": {
      "type": "object",
      "description": "ETL job metadata for data flow relationships",
      "required": ["jobName"],
      "properties": {
        "jobName": {
          "type": "string",
          "description": "Name of the ETL job that creates this relationship"
        },
        "notes": {
          "type": "string",
          "description": "Optional notes about the ETL job"
        },
        "frequency": {
          "type": "string",
          "description": "Job execution frequency (e.g., 'daily', 'hourly')"
        }
      },
      "additionalProperties": false
    },
    "SlaProperty": {
      "type": "object",
      "description": "SLA (Service Level Agreement) property. Also defined in common-types-schema.json.",
      "required": ["property", "value", "unit"],
      "properties": {
        "property": {
          "type": "string",
          "description": "Name of the SLA property (e.g., 'latency', 'availability')"
        },
        "value": {
          "description": "Value of the SLA property"
        },
        "unit": {
          "type": "string",
          "description": "Unit of measurement (e.g., 'hours', 'percent')"
        },
        "description": {
          "type": "string",
          "description": "Description of the SLA property"
        },
        "element": {
          "type": "string",
          "description": "Element this SLA applies to"
        },
        "driver": {
          "type": "string",
          "description": "Driver or reason for the SLA"
        },
        "scheduler": {
          "type": "string",
          "description": "Scheduler for SLA enforcement"
        },
        "schedule": {
          "type": "string",
          "description": "Schedule for SLA checks"
        }
      },
      "additionalProperties": false
    },
    "ContactDetails": {
      "type": "object",
      "description": "Contact information for responsible parties. Also defined in common-types-schema.json.",
      "properties": {
        "email": {
          "type": "string",
          "format": "email",
          "description": "Contact email address"
        },
        "phone": {
          "type": "string",
          "description": "Contact phone number"
        },
        "name": {
          "type": "string",
          "description": "Contact name"
        },
        "role": {
          "type": "string",
          "description": "Contact role"
        },
        "other": {
          "type": "string",
          "description": "Other contact information"
        }
      },
      "additionalProperties": false
    },
    "VisualMetadata": {
      "type": "object",
      "description": "Visual metadata for relationship rendering on canvas",
      "properties": {
        "sourceConnectionPoint": {
          "type": "string",
          "description": "Connection point identifier on source table"
        },
        "targetConnectionPoint": {
          "type": "string",
          "description": "Connection point identifier on target table"
        },
        "routingWaypoints": {
          "type": "array",
          "description": "Waypoints for routing the relationship line",
          "items": {
            "$ref": "#/definitions/ConnectionPoint"
          }
        },
        "labelPosition": {
          "$ref": "#/definitions/ConnectionPoint"
        }
      },
      "additionalProperties": false
    },
    "ConnectionPoint": {
      "type": "object",
      "description": "X/Y coordinates for connection point or waypoint. Also defined in common-types-schema.json.",
      "required": ["x", "y"],
      "properties": {
        "x": {
          "type": "number",
          "description": "X coordinate"
        },
        "y": {
          "type": "number",
          "description": "Y coordinate"
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174000",
      "name": "enterprise",
      "ownerId": "987fcdeb-51a2-43e1-b123-456789abcdef",
      "createdAt": "2025-01-01T09:00:00Z",
      "lastModifiedAt": "2025-01-05T16:30:00Z",
      "domains": [
        {
          "id": "550e8400-e29b-41d4-a716-446655440000",
          "name": "sales",
          "description": "Sales domain",
          "systems": [
            {
              "id": "660e8400-e29b-41d4-a716-446655440001",
              "name": "kafka",
              "description": "Kafka streaming platform",
              "systemType": "Kafka",
              "environments": [
                {
                  "environment": "production",
                  "owner": "Platform Team",
                  "supportTeam": "platform-oncall",
                  "authMethod": "saml",
                  "endpoint": "kafka-prod.example.com",
                  "port": 9092,
                  "region": "us-east-1",
                  "status": "active",
                  "sla": [
                    {
                      "property": "availability",
                      "value": 99.9,
                      "unit": "percent"
                    }
                  ]
                },
                {
                  "environment": "staging",
                  "owner": "Platform Team",
                  "endpoint": "kafka-staging.example.com",
                  "port": 9092,
                  "status": "active"
                }
              ]
            },
            {
              "id": "770e8400-e29b-41d4-a716-446655440002",
              "name": "postgres",
              "description": "PostgreSQL database",
              "systemType": "PostgreSQL",
              "environments": [
                {
                  "environment": "production",
                  "owner": "Database Team",
                  "authMethod": "iamRole",
                  "secretLink": "https://vault.example.com/secrets/postgres-prod",
                  "endpoint": "postgres-prod.example.com",
                  "port": 5432,
                  "region": "us-east-1",
                  "status": "active"
                }
              ]
            }
          ]
        },
        {
          "id": "880e8400-e29b-41d4-a716-446655440003",
          "name": "finance",
          "systems": []
        }
      ],
      "assets": [
        {
          "id": "990e8400-e29b-41d4-a716-446655440004",
          "name": "orders",
          "domain": "sales",
          "system": "kafka",
          "assetType": "odcs",
          "filePath": "enterprise_sales_kafka_orders.odcs.yaml"
        },
        {
          "id": "aa0e8400-e29b-41d4-a716-446655440005",
          "name": "customers",
          "domain": "sales",
          "system": "postgres",
          "assetType": "odcs",
          "filePath": "enterprise_sales_postgres_customers.odcs.yaml"
        },
        {
          "id": "bb0e8400-e29b-41d4-a716-446655440006",
          "name": "accounts",
          "domain": "finance",
          "assetType": "odcs",
          "filePath": "enterprise_finance_accounts.odcs.yaml"
        },
        {
          "id": "cc0e8400-e29b-41d4-a716-446655440007",
          "name": "sales-analytics",
          "domain": "sales",
          "assetType": "odps",
          "filePath": "enterprise_sales_sales-analytics.odps.yaml"
        }
      ],
      "relationships": [
        {
          "id": "dd0e8400-e29b-41d4-a716-446655440008",
          "sourceTableId": "990e8400-e29b-41d4-a716-446655440004",
          "targetTableId": "aa0e8400-e29b-41d4-a716-446655440005",
          "sourceCardinality": "exactlyOne",
          "targetCardinality": "zeroOrMany",
          "flowDirection": "sourceToTarget",
          "relationshipType": "foreignKey",
          "notes": "Orders reference customers",
          "createdAt": "2025-01-01T09:00:00Z",
          "updatedAt": "2025-01-01T09:00:00Z"
        }
      ]
    }
  ]
}
